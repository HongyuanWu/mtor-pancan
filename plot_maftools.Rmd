---
params:
    id: "fea333b5-78e0-43c8-bf76-4c78dd3fac92"
title: "mTOR and pathway, maftools analysis"
subtitle: "preliminary exploration"
date: "Figures last updated: `r Sys.time()`"
output: html_document
---


***

```{r, setup, echo=F, include = F}
library("maftools")
library(BSgenome.Hsapiens.UCSC.hg19, quietly = TRUE)
knitr::opts_chunk$set(echo = F, message = F, warning = F, 
					  results = 'hide', fig.align = 'center',
					  out.width = '100%')
```

```{r, manifest}
maf_dir <- "data"
result_dir <- "results"
manifest <- "gdc_manifest_20200722_033552.txt"

# set up manifest data 
manifest <- read.delim(manifest, stringsAsFactors=F)
manifest$cancer_type <- sapply(strsplit(manifest$filename, split = ".", fixed = T), "[[", 2)
manifest$maf_fn <- paste(maf_dir, manifest$id, manifest$filename, sep = "/")
manifest$maf_fn <- gsub('.{3}$', '', manifest$maf_fn)
manifest$caller <- sapply(strsplit(manifest$maf_fn, split = ".", fixed = T), "[[", 3)
manifest$result_fn <- paste0(result_dir, "/", manifest$id, ".sig_genes.txt")

id <- params$id
maf_fn <- manifest[manifest$id == id, ]$maf_fn
result_fn <- manifest[manifest$id == id, ]$result_fn
maf_data <- read.maf(maf_fn)
```

```{r, maftools}
# pathway lists
gene <- list(c("EGFR", "FGFR1", "ERBB2", "ERBB4", "ROS1", "ERBB3", "MET", "ALK", "FLT1", "PDGFRA", "FLT3", "FLT4", "RET", "FGFR2", "FGFR3"),
			 c("PI3K", "PIK3CA", "PTEN", "AKT3", "MTOR", "AKT2", "TSC2", "TSC1", "AKT2"),
			 c("SAMTOR", "BMT2", "CASTOR1", "CASTOR2"),
			 c("GATOR1", "DEPDC5", "NPRL2", "NPRL3"),
			 c("GATOR2", "MIOS", "SEH1L", "SEC13", "WDR24", "WDR59", "SLC38A9"),
			 c("KICSTOR", "C12ORF66", "ITFG2", "KPTN", "SZT2", "SESN2")
		    )
pw_name <- c("RTKS pthw", "PI3K pthw", "SAMTOR pthw", "GATOR1 pthw", "GATOR2 pthw", "KICSTOR pthlsw")
pathways <- data.frame(unlist(gene), rep(pw_name, times = sapply(gene, length)))
pidx <- length(gene[[1]]) + length(gene[[2]]) + 1

onco_p_plot <- function(id, m, r, pathways){

	maf_data <- read.maf(m)
	result_data <- read.delim(r, stringsAsFactors=F)

	#ord <- match(maf_data@data$Hugo_Symbol, result_data$gene, nomatch=0)
	rb_data <- result_data[, c("gene", "p")]
	oncoplot(maf = maf_data, pathways = pathways, 
			 rightBarData = rb_data, rightBarLims = c(0, 0.1),
			 gene_mar = 8)
}

```

# `r manifest[manifest$id == id, ]$cancer_type`

<div class="alert alert-info" role="alert">
File id: `r id`

Mutation caller: `r manifest[manifest$id == id, ]$caller`
</div>

## MAF summary

```{r}
# plot maf summary
try(plotmafSummary(maf = maf_data, rmOutlier = T, addStat = 'median', dashboard = TRUE, titvRaw = FALSE))
```

## Lollipop plot

```{r}
# plot mtor lollipop
try(lollipopPlot(maf = maf_data, gene = 'MTOR', showMutationRate = TRUE))
```

## Oncogenic pathways

### Top oncogenic pathway activity

```{r}
# plot oncogenic pathways
try(OncogenicPathways(maf = maf_data))
```

### RTK-RAS 

Blue are oncogenes, red are tumour suppressors

```{r}
try(PlotOncogenicPathways(maf = maf_data, pathways = "RTK-RAS"))
```

### PI3K

Blue are oncogenes, red are tumour suppressors

```{r}
try(PlotOncogenicPathways(maf = maf_data, pathways = "PI3K"))
```

## OncoDriveClust

```{r}
# plot oncodriveclust
sig <- invisible(oncodrive(maf = maf_data, minMut = 5, pvalMethod = 'zscore'))
try(plotOncodrive(res = sig, fdrCutOff = 0.1, useFraction = TRUE))
```

## Oncoplot

### Top mutated genes

```{r}
# default oncoplot
oncoplot(maf = maf_data, gene_mar = 8, fontSize = 0.6)
```

### Curated pathways 

P-value determined by MutSigCV

```{r}
# make oncoplot with p-value barplot
onco_p_plot(id, maf_fn, result_fn, pathways[1:pidx,])
onco_p_plot(id, maf_fn, result_fn, pathways[pidx:dim(pathways)[1],])

```
